<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›”ë³„ ìê¸ˆí˜„í™© PDF Export</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .main-content {
            padding: 30px;
        }

        .auto-section {
            background: #e8f5e8;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #10b981;
            text-align: center;
        }

        .auto-section h3 {
            color: #065f46;
            margin-bottom: 15px;
        }

        .status {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
            text-align: center;
        }

        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .status.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .pdf-preview {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            max-height: 600px;
            overflow-y: auto;
        }

        .report-header {
            text-align: center;
            border-bottom: 3px solid #4f46e5;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .report-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 10px;
        }

        .report-date {
            color: #6b7280;
            font-size: 1em;
        }

        .summary-section {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #3b82f6;
        }

        .section-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: '';
            width: 16px;
            height: 16px;
            margin-right: 8px;
            border-radius: 50%;
        }

        .section-title.income::before {
            background: #10b981;
        }

        .section-title.expense::before {
            background: #ef4444;
        }

        .section-title.asset::before {
            background: #8b5cf6;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9em;
        }

        .data-table th,
        .data-table td {
            padding: 8px 12px;
            text-align: right;
            border-bottom: 1px solid #e5e7eb;
        }

        .data-table th {
            text-align: left;
            background: #f9fafb;
            font-weight: 600;
        }

        .data-table .total-row {
            background: #f3f4f6;
            font-weight: bold;
        }

        .amount {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .positive {
            color: #059669;
        }

        .negative {
            color: #dc2626;
        }

        .btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(79, 70, 229, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .error-section {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .error-section h3 {
            color: #991b1b;
            margin-bottom: 10px;
        }

        .error-section p {
            color: #7f1d1d;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š ì›”ë³„ ìê¸ˆí˜„í™© PDF Export</h1>
            <p>Notion ROW ê¸°ë°˜ ìë™ PDF ìƒì„±</p>
        </div>

        <div class="main-content">
            <div class="auto-section">
                <h3>ğŸš€ ìë™ PDF ìƒì„±</h3>
                <p>URL íŒŒë¼ë¯¸í„°ë¡œ ROW IDê°€ ì „ë‹¬ë˜ë©´ ìë™ìœ¼ë¡œ PDFë¥¼ ìƒì„±í•©ë‹ˆë‹¤</p>
                <p><small>ì‚¬ìš©ë²•: ?rowId=í˜ì´ì§€ID</small></p>
            </div>

            <div id="statusDiv"></div>
            <div id="dataPreview"></div>
            <div id="pdfPreview"></div>
        </div>
    </div>

    <script>
        // URL íŒŒë¼ë¯¸í„°ì—ì„œ rowId ì¶”ì¶œ
        const urlParams = new URLSearchParams(window.location.search);
        const rowId = urlParams.get('rowId');

        window.onload = function() {
            if (rowId) {
                showStatus('ROW IDê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 'info');
                loadRowData(rowId);
            } else {
                showError();
            }
        };

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusDiv');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function showLoading(message) {
            const statusDiv = document.getElementById('statusDiv');
            statusDiv.innerHTML = `<div class="status info"><span class="loading"></span>${message}</div>`;
        }

        function showError() {
            const statusDiv = document.getElementById('statusDiv');
            statusDiv.innerHTML = `
                <div class="error-section">
                    <h3>âš ï¸ ROW IDê°€ í•„ìš”í•©ë‹ˆë‹¤</h3>
                    <p>ì´ í˜ì´ì§€ëŠ” Notion ROWì—ì„œ ì§ì ‘ í˜¸ì¶œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</p>
                    <p><strong>ì‚¬ìš© ë°©ë²•:</strong></p>
                    <p>1. Notion ë°ì´í„°ë² ì´ìŠ¤ì˜ "PDF Export" ì»¬ëŸ¼ì— ë‹¤ìŒ URLì„ ì…ë ¥í•˜ì„¸ìš”:</p>
                    <p><code>https://ì´ì£¼ì†Œ.com?rowId=ROW_ID</code></p>
                    <p>2. ROW_IDëŠ” ê° í˜ì´ì§€ì˜ ê³ ìœ  IDì…ë‹ˆë‹¤.</p>
                </div>
            `;
        }

        async function loadRowData(rowId) {
            showLoading('Notionì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');

            try {
                // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” Notion API í˜¸ì¶œ
                // ì—¬ê¸°ì„œëŠ” ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©
                setTimeout(() => {
                    const sampleData = generateSampleDataFromRowId(rowId);
                    
                    showDataPreview(sampleData);
                    showPDFPreview(sampleData);
                    showStatus('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. PDFë¥¼ ìƒì„±í•©ë‹ˆë‹¤.', 'success');
                    
                    // 2ì´ˆ í›„ ìë™ìœ¼ë¡œ PDF ìƒì„±
                    setTimeout(() => {
                        generatePDF(sampleData);
                    }, 2000);
                    
                }, 1500);
                
            } catch (error) {
                showStatus('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }

        function generateSampleDataFromRowId(rowId) {
            // ROW IDë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•´ë‹¹ ì›”ì˜ ë°ì´í„° ìƒì„±
            // ì‹¤ì œë¡œëŠ” Notion APIì—ì„œ í•´ë‹¹ ROW ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
            const monthData = {
                '22c59afa-5ce0-810a-9ef5-eba23d52b156': '2025-09',
                '22c59afa-5ce0-81f9-88ea-ecf47ac82574': '2025-08', 
                '22c59afa-5ce0-8112-9153-c1ee7bc961af': '2025-07'
            };

            const month = monthData[rowId] || '2025-09';
            
            return {
                month: month,
                rowId: rowId,
                income: {
                    salary: 3200000,
                    investment: 250000,
                    other: 150000,
                    total: 3600000
                },
                fixedExpenses: {
                    loan: 300000,
                    insurance: 180000,
                    transport: 120000,
                    communication: 75000,
                    motherLiving: 500000,
                    meeting: 30000,
                    subscription: 45000,
                    savings: 800000,
                    other: 50000,
                    total: 2100000
                },
                variableExpenses: 750000,
                totalExpenses: 2850000,
                assets: {
                    cash: 5200000,
                    deposit: 12500000,
                    total: 17700000
                },
                surplus: 750000
            };
        }

        function showDataPreview(data) {
            const previewDiv = document.getElementById('dataPreview');
            previewDiv.innerHTML = `
                <div class="summary-section">
                    <h3>ğŸ“‹ ë°ì´í„° í™•ì¸ - ${data.month}</h3>
                    <p><strong>ROW ID:</strong> ${data.rowId}</p>
                    <table class="data-table">
                        <tr><th>í•­ëª©</th><th>ê¸ˆì•¡</th></tr>
                        <tr><td>ì´ ìˆ˜ì…</td><td class="amount positive">${formatCurrency(data.income.total)}</td></tr>
                        <tr><td>ì´ ì§€ì¶œ</td><td class="amount negative">${formatCurrency(data.totalExpenses)}</td></tr>
                        <tr><td>ì”ì—¬ê¸ˆ</td><td class="amount ${data.surplus >= 0 ? 'positive' : 'negative'}">${formatCurrency(data.surplus)}</td></tr>
                    </table>
                </div>
            `;
        }

        function showPDFPreview(data) {
            const previewDiv = document.getElementById('pdfPreview');
            previewDiv.innerHTML = `
                <div class="pdf-preview">
                    <div class="report-header">
                        <div class="report-title">${data.month} ì›”ë³„ ìê¸ˆí˜„í™© ë³´ê³ ì„œ</div>
                        <div class="report-date">ìƒì„±ì¼: ${new Date().toLocaleDateString('ko-KR')}</div>
                    </div>

                    <div class="summary-section">
                        <div class="section-title">ğŸ“Š ì›”ê°„ ìš”ì•½</div>
                        <table class="data-table">
                            <tr><td>ì´ ìˆ˜ì…</td><td class="amount positive">${formatCurrency(data.income.total)}</td></tr>
                            <tr><td>ì´ ì§€ì¶œ</td><td class="amount negative">${formatCurrency(data.totalExpenses)}</td></tr>
                            <tr class="total-row"><td>ì”ì—¬ê¸ˆ</td><td class="amount ${data.surplus >= 0 ? 'positive' : 'negative'}">${formatCurrency(data.surplus)}</td></tr>
                        </table>
                    </div>

                    <div class="summary-section">
                        <div class="section-title income">ğŸ“ˆ ìˆ˜ì… í˜„í™©</div>
                        <table class="data-table">
                            <tr><td>ê¸‰ì—¬</td><td class="amount">${formatCurrency(data.income.salary)}</td></tr>
                            <tr><td>íˆ¬ììˆ˜ìµ</td><td class="amount">${formatCurrency(data.income.investment)}</td></tr>
                            <tr><td>ê¸°íƒ€ìˆ˜ìµ</td><td class="amount">${formatCurrency(data.income.other)}</td></tr>
                            <tr class="total-row"><td>ì´ ìˆ˜ì…</td><td class="amount positive">${formatCurrency(data.income.total)}</td></tr>
                        </table>
                    </div>

                    <div class="summary-section">
                        <div class="section-title expense">ğŸ“‰ ì§€ì¶œ í˜„í™©</div>
                        <h4>ã€ê³ ì •ì§€ì¶œã€‘</h4>
                        <table class="data-table">
                            <tr><td>ëŒ€ì¶œìƒí™˜</td><td class="amount">${formatCurrency(data.fixedExpenses.loan)}</td></tr>
                            <tr><td>ë³´í—˜ë£Œ</td><td class="amount">${formatCurrency(data.fixedExpenses.insurance)}</td></tr>
                            <tr><td>êµí†µë¹„</td><td class="amount">${formatCurrency(data.fixedExpenses.transport)}</td></tr>
                            <tr><td>í†µì‹ ë¹„</td><td class="amount">${formatCurrency(data.fixedExpenses.communication)}</td></tr>
                            <tr><td>ì–´ë¨¸ë‹ˆìƒí™œë¹„</td><td class="amount">${formatCurrency(data.fixedExpenses.motherLiving)}</td></tr>
                            <tr><td>ëª¨ì„íšŒë¹„</td><td class="amount">${formatCurrency(data.fixedExpenses.meeting)}</td></tr>
                            <tr><td>êµ¬ë…ë£Œ</td><td class="amount">${formatCurrency(data.fixedExpenses.subscription)}</td></tr>
                            <tr><td>ì ê¸ˆ</td><td class="amount">${formatCurrency(data.fixedExpenses.savings)}</td></tr>
                            <tr><td>ê¸°íƒ€</td><td class="amount">${formatCurrency(data.fixedExpenses.other)}</td></tr>
                            <tr class="total-row"><td>ê³ ì •ì§€ì¶œ ì†Œê³„</td><td class="amount">${formatCurrency(data.fixedExpenses.total)}</td></tr>
                        </table>

                        <h4>ã€ë³€ë™ì§€ì¶œã€‘</h4>
                        <table class="data-table">
                            <tr><td>ë³€ë™ì§€ì¶œ ì´ì•¡</td><td class="amount">${formatCurrency(data.variableExpenses)}</td></tr>
                        </table>

                        <table class="data-table">
                            <tr class="total-row"><td>ì´ ì§€ì¶œ</td><td class="amount negative">${formatCurrency(data.totalExpenses)}</td></tr>
                        </table>
                    </div>

                    <div class="summary-section">
                        <div class="section-title asset">ğŸ’° ìì‚° í˜„í™©</div>
                        <table class="data-table">
                            <tr><td>í˜„ê¸ˆ</td><td class="amount">${formatCurrency(data.assets.cash)}</td></tr>
                            <tr><td>ì ê¸ˆ</td><td class="amount">${formatCurrency(data.assets.deposit)}</td></tr>
                            <tr class="total-row"><td>ì´ ìì‚°</td><td class="amount">${formatCurrency(data.assets.total)}</td></tr>
                        </table>
                    </div>

                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn" onclick="generatePDF(currentData)">ğŸ“„ PDF ë‹¤ì‹œ ë‹¤ìš´ë¡œë“œ</button>
                    </div>
                </div>
            `;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('ko-KR', {
                style: 'currency',
                currency: 'KRW'
            }).format(amount);
        }

        let currentData = null;

        function generatePDF(data) {
            if (!data) {
                showStatus('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            currentData = data;
            showLoading('PDFë¥¼ ìƒì„±í•˜ëŠ” ì¤‘...');

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                // ì œëª©
                doc.setFontSize(18);
                doc.text(`${data.month} ì›”ë³„ ìê¸ˆí˜„í™© ë³´ê³ ì„œ`, 20, 25);
                
                doc.setFontSize(10);
                doc.text(`ìƒì„±ì¼: ${new Date().toLocaleDateString('ko-KR')}`, 20, 35);

                let y = 50;

                // ì›”ê°„ ìš”ì•½
                doc.setFontSize(14);
                doc.text('ì›”ê°„ ìš”ì•½', 20, y);
                y += 8;
                
                doc.setFontSize(11);
                doc.text(`ì´ ìˆ˜ì…: ${formatCurrency(data.income.total)}`, 25, y);
                y += 6;
                doc.text(`ì´ ì§€ì¶œ: ${formatCurrency(data.totalExpenses)}`, 25, y);
                y += 6;
                doc.text(`ì”ì—¬ê¸ˆ: ${formatCurrency(data.surplus)}`, 25, y);
                y += 12;

                // ìˆ˜ì… í˜„í™©
                doc.setFontSize(14);
                doc.text('ìˆ˜ì… í˜„í™©', 20, y);
                y += 8;
                
                doc.setFontSize(11);
                doc.text(`ê¸‰ì—¬: ${formatCurrency(data.income.salary)}`, 25, y);
                y += 5;
                doc.text(`íˆ¬ììˆ˜ìµ: ${formatCurrency(data.income.investment)}`, 25, y);
                y += 5;
                doc.text(`ê¸°íƒ€ìˆ˜ìµ: ${formatCurrency(data.income.other)}`, 25, y);
                y += 5;
                doc.text(`ì´ ìˆ˜ì…: ${formatCurrency(data.income.total)}`, 25, y);
                y += 12;

                // ì§€ì¶œ í˜„í™©
                doc.setFontSize(14);
                doc.text('ì§€ì¶œ í˜„í™©', 20, y);
                y += 8;
                
                doc.setFontSize(12);
                doc.text('ê³ ì •ì§€ì¶œ', 25, y);
                y += 6;
                
                doc.setFontSize(10);
                const expenses = data.fixedExpenses;
                doc.text(`ëŒ€ì¶œìƒí™˜: ${formatCurrency(expenses.loan)}`, 30, y);
                y += 4;
                doc.text(`ë³´í—˜ë£Œ: ${formatCurrency(expenses.insurance)}`, 30, y);
                y += 4;
                doc.text(`êµí†µë¹„: ${formatCurrency(expenses.transport)}`, 30, y);
                y += 4;
                doc.text(`í†µì‹ ë¹„: ${formatCurrency(expenses.communication)}`, 30, y);
                y += 4;
                doc.text(`ì–´ë¨¸ë‹ˆìƒí™œë¹„: ${formatCurrency(expenses.motherLiving)}`, 30, y);
                y += 4;
                doc.text(`ëª¨ì„íšŒë¹„: ${formatCurrency(expenses.meeting)}`, 30, y);
                y += 4;
                doc.text(`êµ¬ë…ë£Œ: ${formatCurrency(expenses.subscription)}`, 30, y);
                y += 4;
                doc.text(`ì ê¸ˆ: ${formatCurrency(expenses.savings)}`, 30, y);
                y += 4;
                doc.text(`ê¸°íƒ€: ${formatCurrency(expenses.other)}`, 30, y);
                y += 5;
                doc.text(`ê³ ì •ì§€ì¶œ ì†Œê³„: ${formatCurrency(expenses.total)}`, 30, y);
                y += 8;

                doc.setFontSize(12);
                doc.text('ë³€ë™ì§€ì¶œ', 25, y);
                y += 6;
                
                doc.setFontSize(10);
                doc.text(`ë³€ë™ì§€ì¶œ ì´ì•¡: ${formatCurrency(data.variableExpenses)}`, 30, y);
                y += 6;
                doc.text(`ì´ ì§€ì¶œ: ${formatCurrency(data.totalExpenses)}`, 30, y);
                y += 12;

                // ìì‚° í˜„í™©
                doc.setFontSize(14);
                doc.text('ìì‚° í˜„í™©', 20, y);
                y += 8;
                
                doc.setFontSize(11);
                doc.text(`í˜„ê¸ˆ: ${formatCurrency(data.assets.cash)}`, 25, y);
                y += 5;
                doc.text(`ì ê¸ˆ: ${formatCurrency(data.assets.deposit)}`, 25, y);
                y += 5;
                doc.text(`ì´ ìì‚°: ${formatCurrency(data.assets.total)}`, 25, y);

                // PDF ë‹¤ìš´ë¡œë“œ
                doc.save(`ì›”ë³„ìê¸ˆí˜„í™©_${data.month}.pdf`);
                
                showStatus('PDFê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ë‹¤ìš´ë¡œë“œë¥¼ í™•ì¸í•˜ì„¸ìš”.', 'success');
            } catch (error) {
                showStatus('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html>