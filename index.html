<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›”ë³„ ìê¸ˆí˜„í™© PDF Export</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .main-content {
            padding: 30px;
        }

        .auto-section {
            background: #e8f5e8;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #10b981;
            text-align: center;
        }

        .auto-section h3 {
            color: #065f46;
            margin-bottom: 15px;
        }

        .status {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
            text-align: center;
        }

        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .status.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(79, 70, 229, 0.3);
        }

        #pdfCanvas {
            display: none;
            border: 1px solid #ddd;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š ì›”ë³„ ìê¸ˆí˜„í™© PDF Export</h1>
            <p>Canvas ê¸°ë°˜ ì´ë¯¸ì§€ PDF ìƒì„±</p>
        </div>

        <div class="main-content">
            <div class="auto-section">
                <h3>ğŸš€ ì´ë¯¸ì§€ ê¸°ë°˜ PDF ìƒì„±</h3>
                <p>Canvasë¥¼ ì‚¬ìš©í•´ì„œ ì´ë¯¸ì§€ë¡œ PDFë¥¼ ìƒì„±í•©ë‹ˆë‹¤</p>
                <button class="btn" onclick="generateImagePDF()">ğŸ“„ ì´ë¯¸ì§€ PDF ìƒì„±</button>
            </div>

            <div id="statusDiv"></div>
            <canvas id="pdfCanvas" width="595" height="842"></canvas>
        </div>
    </div>

    <script>
        // URL íŒŒë¼ë¯¸í„°ì—ì„œ rowId ì¶”ì¶œ
        const urlParams = new URLSearchParams(window.location.search);
        const rowId = urlParams.get('rowId');

        window.onload = function() {
            if (rowId) {
                showStatus('ROW IDê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤: ' + rowId, 'info');
                setTimeout(() => {
                    generateImagePDF();
                }, 2000);
            } else {
                showStatus('í…ŒìŠ¤íŠ¸ ëª¨ë“œì…ë‹ˆë‹¤. ë²„íŠ¼ì„ í´ë¦­í•´ì„œ ìƒ˜í”Œ PDFë¥¼ ìƒì„±í•´ë³´ì„¸ìš”.', 'info');
            }
        };

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusDiv');
            statusDiv.innerHTML = '<div class="status ' + type + '">' + message + '</div>';
        }

        function generateImagePDF() {
            showStatus('ì´ë¯¸ì§€ PDFë¥¼ ìƒì„±í•˜ëŠ” ì¤‘...', 'info');
            
            const canvas = document.getElementById('pdfCanvas');
            const ctx = canvas.getContext('2d');
            
            // Canvas í¬ê¸° ì„¤ì • (A4: 595x842px at 72 DPI)
            canvas.width = 595;
            canvas.height = 842;
            
            // ë°°ê²½ìƒ‰ ì„¤ì •
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ì„¤ì •
            ctx.fillStyle = '#000000';
            ctx.textAlign = 'left';
            
            let y = 60;
            
            // ì œëª©
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('2025-09 Monthly Financial Report', canvas.width / 2, y);
            y += 40;
            
            // ìƒì„±ì¼
            ctx.font = '14px Arial';
            ctx.fillText('Generated: ' + new Date().toLocaleDateString(), canvas.width / 2, y);
            y += 60;
            
            // ì„  ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#4f46e5';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, y - 20);
            ctx.lineTo(545, y - 20);
            ctx.stroke();
            
            // ì›”ê°„ ìš”ì•½
            ctx.textAlign = 'left';
            ctx.font = 'bold 18px Arial';
            ctx.fillText('Monthly Summary', 50, y);
            y += 30;
            
            // ìš”ì•½ í‘œ
            drawTable(ctx, 50, y, [
                ['Total Income', '3,600,000 KRW'],
                ['Total Expenses', '2,850,000 KRW'],
                ['Remaining', '750,000 KRW']
            ], 200);
            y += 120;
            
            // ìˆ˜ì… í˜„í™©
            ctx.font = 'bold 18px Arial';
            ctx.fillText('Income Details', 50, y);
            y += 30;
            
            drawTable(ctx, 50, y, [
                ['Salary', '3,200,000 KRW'],
                ['Investment', '250,000 KRW'],
                ['Other Income', '150,000 KRW'],
                ['Total Income', '3,600,000 KRW']
            ], 200);
            y += 140;
            
            // ì§€ì¶œ í˜„í™©
            ctx.font = 'bold 18px Arial';
            ctx.fillText('Expense Details', 50, y);
            y += 30;
            
            ctx.font = 'bold 16px Arial';
            ctx.fillText('Fixed Expenses', 70, y);
            y += 25;
            
            drawTable(ctx, 70, y, [
                ['Loan Payment', '300,000 KRW'],
                ['Insurance', '180,000 KRW'],
                ['Transportation', '120,000 KRW'],
                ['Communication', '75,000 KRW'],
                ['Family Support', '500,000 KRW'],
                ['Meeting Fee', '30,000 KRW'],
                ['Subscription', '45,000 KRW'],
                ['Savings', '800,000 KRW'],
                ['Others', '50,000 KRW'],
                ['Fixed Total', '2,100,000 KRW']
            ], 180);
            y += 280;
            
            ctx.font = 'bold 16px Arial';
            ctx.fillText('Variable Expenses', 70, y);
            y += 25;
            
            drawTable(ctx, 70, y, [
                ['Variable Total', '750,000 KRW']
            ], 180);
            y += 50;
            
            drawTable(ctx, 50, y, [
                ['Total Expenses', '2,850,000 KRW']
            ], 200);
            
            // Canvasë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•˜ê³  PDF ìƒì„±
            const imgData = canvas.toDataURL('image/png');
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'pt', 'a4');
            
            // ì´ë¯¸ì§€ë¥¼ PDFì— ì¶”ê°€
            pdf.addImage(imgData, 'PNG', 0, 0, 595, 842);
            
            // íŒŒì¼ëª… ìƒì„±
            const today = new Date();
            const dateStr = today.getFullYear() + '-' + 
                          String(today.getMonth() + 1).padStart(2, '0');
            
            pdf.save('Monthly_Financial_Report_' + dateStr + '.pdf');
            
            showStatus('ì´ë¯¸ì§€ PDFê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }
        
        function drawTable(ctx, x, y, data, colWidth) {
            const rowHeight = 25;
            const tableWidth = colWidth * 2;
            
            // í…Œì´ë¸” í…Œë‘ë¦¬
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            
            for (let i = 0; i < data.length; i++) {
                const currentY = y + (i * rowHeight);
                
                // í–‰ ë°°ê²½ (ë§ˆì§€ë§‰ í–‰ì€ ê°•ì¡°)
                if (i === data.length - 1) {
                    ctx.fillStyle = '#f3f4f6';
                    ctx.fillRect(x, currentY - 15, tableWidth, rowHeight);
                }
                
                // ì…€ í…Œë‘ë¦¬
                ctx.strokeRect(x, currentY - 15, colWidth, rowHeight);
                ctx.strokeRect(x + colWidth, currentY - 15, colWidth, rowHeight);
                
                // í…ìŠ¤íŠ¸
                ctx.fillStyle = '#000000';
                ctx.font = (i === data.length - 1) ? 'bold 14px Arial' : '14px Arial';
                ctx.textAlign = 'left';
                ctx.fillText(data[i][0], x + 10, currentY);
                ctx.textAlign = 'right';
                ctx.fillText(data[i][1], x + tableWidth - 10, currentY);
            }
        }
    </script>
</body>
</html>